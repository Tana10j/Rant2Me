<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin — Manage Resources</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans p-6">

  <h1 class="text-2xl font-bold mb-6">Manage Resources</h1>

  <!-- Add Resource Form -->
  <form id="resourceForm" class="bg-white shadow p-6 rounded-lg space-y-4 max-w-lg">
    <input id="title" placeholder="Title" class="w-full border px-3 py-2 rounded" required />
    <input id="author" placeholder="Author" class="w-full border px-3 py-2 rounded" />
    <input id="cover" placeholder="Cover image URL (optional)" class="w-full border px-3 py-2 rounded" />
    <textarea id="pages" placeholder="Enter pages separated by ---" class="w-full border px-3 py-2 rounded h-40"></textarea>
    <button class="bg-r2m-blue text-white px-4 py-2 rounded" type="submit">Add Resource</button>
  </form>

  <!-- Resource List -->
  <div class="mt-8">
    <h2 class="text-lg font-semibold mb-4">Existing Resources</h2>
    <ul id="resourceList" class="space-y-2"></ul>
  </div>

  <style>
    :root { --r2m-blue: #296ead; }
    .bg-r2m-blue { background-color: var(--r2m-blue); }
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = {
  apiKey: "AIzaSyAEVKUuUn0rypPGTzJ2UsVIy9HGYUBHLhI",
  authDomain: "rant2me-ab36b.firebaseapp.com",
  projectId: "rant2me-ab36b",
  storageBucket: "rant2me-ab36b.appspot.com",
  messagingSenderId: "245661393279",
  appId: "1:245661393279:web:b31483f57a40cf2c807a4a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const form = document.getElementById("resourceForm");
    const list = document.getElementById("resourceList");

 // ✅ Check if user is already logged in
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      console.log("Logged in as:", user.email);

      // Optional: enforce that only admins can use this page
      const adminEmails = ["tana10j@gmail.com", "edukdorcas@gmail.com"];
      if (!adminEmails.includes(user.email)) {
        alert("Access denied: you are not an admin.");
        window.location.href = "index.html"; // redirect non-admins
        return;
      }
    
    async function loadResources() {
      const snapshot = await getDocs(collection(db, "resources"));
      list.innerHTML = "";
      snapshot.forEach(d => {
        const data = d.data();
        const li = document.createElement("li");
        li.className = "bg-white p-3 rounded shadow flex justify-between items-center";
        li.innerHTML = `
          <div>
            <div class="font-semibold">${data.title}</div>
            <div class="text-sm text-gray-500">${data.author || "Anonymous"}</div>
          </div>
          <button class="text-red-500" onclick="deleteResource('${d.id}')">Delete</button>
        `;
        list.appendChild(li);
      });
    }

    form.onsubmit = async (e) => {
      e.preventDefault();
      const title = document.getElementById("title").value;
      const author = document.getElementById("author").value;
      const cover = document.getElementById("cover").value;
      const pages = document.getElementById("pages").value.split("---").map(p => p.trim());

      await addDoc(collection(db, "resources"), { title, author, cover, pages });
      form.reset();
      loadResources();
    };

    window.deleteResource = async (id) => {
      await deleteDoc(doc(db, "resources", id));
      loadResources();
    };

    loadResources();
    }
  });
  </script>
</body>
</html>
