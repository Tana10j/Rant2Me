<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rant2Me - Chat</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Anonymous Chat</h1>
    <nav>
      <a href="home.html">Home</a>
      <a href="chat.html">Chat</a>
      <a href="help.html">Help Centre</a>
      <a href="faq.html">FAQ</a>
      <a href="token.html">Tokens</a>
      <a href="about.html">About Us</a>
      <a href="services.html">Services</a>
    </nav>
  </header>

  <section class="chat-box">
    <div class="bot-message" id="intro-message">ðŸ‘‹ Hello! Welcome to Rant2Me, your safe place to be heard. How can we support you today?</div>

    <div id="chat-output"></div>
    <textarea placeholder="Type your message here..."></textarea>
    <button id="sendBtn">Send</button>
    <p class="disclaimer">Your privacy is our priority. Nothing you say here will be saved.</p>
  </section>

  <section class="dropdown-services">
    <h2>Choose A Support Service</h2>
    <div class="service-list">
      <div class="service-card" onclick="location.href='chat-counselling.html'">
        <h3>Counselling</h3>
        <p>Talk to Tana â€“ Your friendly guide</p>
      </div>
      <div class="service-card" onclick="location.href='chat-nutrition.html'">
        <h3>Nutrition & Wellness</h3>
        <p>Talk to Dorcas â€“ Nutritionist & Wellness Coach</p>
      </div>
      <div class="service-card" onclick="location.href='chat-student.html'">
        <h3>Student Support</h3>
        <p>Talk to Chidera â€“ Student Guide & Buddy</p>
      </div>
      <div class="service-card" onclick="location.href='chat.html'">
        <h3>Anonymous Rant</h3>
        <p>No names. No records. Just honesty.</p>
      </div>
    </div>
  </section>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAEVKUuUn0rypPGTzJ2UsVIy9HGYUBHLhI",
    authDomain: "rant2me-ab36b.firebaseapp.com",
    projectId: "rant2me-ab36b",
    storageBucket: "rant2me-ab36b.firebasestorage.app",
    messagingSenderId: "245661393279",
    appId: "1:245661393279:web:b31483f57a40cf2c807a4a"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  let userRole = "user";
  let userEmail = "";

  onAuthStateChanged(auth, async (user) => {
    if (user) {
      const token = await user.getIdTokenResult(true);
      userRole = token.claims.role || "user";
      userEmail = user.email;

      console.log(`Logged in as ${userEmail} with role ${userRole}`);

      // Attach click handlers AFTER we know the role/email
      document.querySelectorAll(".service-card").forEach(card => {
        card.addEventListener("click", () => {
          const service = card.querySelector("h3").innerText.trim().toLowerCase();

          if (service.includes("counselling")) {
            if (userRole === "counselling" || userEmail === "tana10j@gmail.com") {
              location.href = "admin-counselling.html";
            } else {
              location.href = "chat-counselling.html";
            }
          }

          if (service.includes("nutrition")) {
            if (userRole === "nutrition" || userEmail === "edukdorcas@gmail.com") {
              location.href = "admin-nutrition.html";
            } else {
              location.href = "chat-nutrition.html";
            }
          }

          if (service.includes("student")) {
            if (userRole === "student" || userEmail === "SOME_STUDENT_ADMIN_EMAIL") {
              location.href = "admin-student.html";
            } else {
              location.href = "chat-student.html";
            }
          }

          if (service.includes("anonymous")) {
            location.href = "chat.html";
          }
        });
      });
    } else {
      console.log("No user logged in â€” redirecting to login page");
      window.location.href = "login.html";
    }
  });
</script>
  <script src="script.js"></script>
</body>
</html>
